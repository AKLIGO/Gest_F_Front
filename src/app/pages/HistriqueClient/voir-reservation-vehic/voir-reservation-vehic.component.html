<div class="p-4">
  <!-- Titre de la page -->
  <h2 class="text-2xl font-bold mb-6">Mes Réservations Véhicules</h2>

  <!-- Message de chargement -->
  <div *ngIf="loading" class="text-center text-gray-500 mb-4">
    <span class="animate-pulse">Chargement des véhicules...</span>
  </div>

  <!-- Tableau des réservations -->
  <div *ngIf="!loading && reservations.length > 0" class="overflow-x-auto">
    <table class="min-w-full table-auto bg-white border border-gray-200 rounded-lg shadow-sm">

      <!-- En-tête -->
      <thead class="bg-gray-100">
        <tr>
          <th class="px-4 py-2 text-left text-gray-600">ID</th>
          <th class="px-4 py-2 text-left text-gray-600">Marque</th>
          <th class="px-4 py-2 text-left text-gray-600">Immatriculation</th>
          <th class="px-4 py-2 text-left text-gray-600">Date Début</th>
          <th class="px-4 py-2 text-left text-gray-600">Date Fin</th>
          <th class="px-4 py-2 text-left text-gray-600">Statut</th>
          <th class="px-4 py-2 text-center text-gray-600">Action</th>
        </tr>
      </thead>

      <!-- Corps du tableau -->
      <tbody>
        <tr *ngFor="let res of reservations" class="border-t border-gray-200 hover:bg-gray-50">

         <!-- ID -->
    <td class="px-4 py-2 flex items-center space-x-2 whitespace-nowrap min-w-[100px]">
  <i class="fa fa-hashtag text-gray-400"></i>
  <span>{{ res.id }}</span>
</td>

<td class="px-4 py-2 flex items-center space-x-2 whitespace-nowrap min-w-[140px]">
  <i class="fa fa-car text-blue-500"></i>
  <span>{{ res.vehiculeMarque }}</span>
</td>
          <!-- Immatriculation -->
          <td class="px-4 py-2">{{ res.vehiculeImmatriculation }}</td>

          <!-- Dates -->
          <td class="px-4 py-2">{{ res.dateDebut }}</td>
          <td class="px-4 py-2">{{ res.dateFin }}</td>

          <!-- Statut avec badge coloré -->
          <td class="px-4 py-2">
            <span
              class="px-2 py-1 rounded-full text-xs font-semibold"
              [ngClass]="{
                'bg-green-500 text-white': res.statut === 'CONFIRMEE',
                'bg-yellow-500 text-black': res.statut === 'EN_ATTENTE',
                'bg-red-500 text-white': res.statut === 'ANNULEE'
              }">
              {{ res.statut }}
            </span>
          </td>

          <!-- Bouton Payer -->
          <td class="px-4 py-2 text-center">
            <button
              class="flex items-center justify-center bg-blue-500 hover:bg-blue-600 text-white px-4 py-1 rounded transition duration-200"
              (click)="payerReservation(res.id)">
              <i class="fa fa-credit-card mr-2"></i>
              Payer
            </button>
          </td>

        </tr>
      </tbody>
    </table>
  </div>

  <!-- Message si aucune réservation -->
  <div *ngIf="!loading && reservations.length === 0" class="text-center text-gray-500 mt-6">
    <p>Aucune réservation de véhicule trouvée.</p>
  </div>
</div>

<!-- Modal de paiement -->
<div *ngIf="showPaymentForm" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6">
    
    <!-- En-tête du modal -->
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-xl font-bold text-gray-800">
        <i class="fa fa-credit-card mr-2 text-blue-500"></i>
        Paiement Mobile Money
      </h3>
      <button (click)="closePaymentForm()" class="text-gray-400 hover:text-gray-600">
        <i class="fa fa-times text-xl"></i>
      </button>
    </div>

    <!-- Informations de réservation -->
    <div *ngIf="selectedReservation" class="bg-gray-50 rounded p-3 mb-4">
      <p class="text-sm text-gray-600">
        <strong>Véhicule:</strong> {{ selectedReservation.vehiculeMarque }} - {{ selectedReservation.vehiculeImmatriculation }}
      </p>
      <p class="text-sm text-gray-600">
        <strong>Période:</strong> {{ selectedReservation.dateDebut }} - {{ selectedReservation.dateFin }}
      </p>
    </div>

    <!-- Message d'erreur -->
    <div *ngIf="paymentError" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
      <i class="fa fa-exclamation-circle mr-2"></i>
      {{ paymentError }}
    </div>

    <!-- Message de succès -->
    <div *ngIf="paymentSuccess" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
      <i class="fa fa-check-circle mr-2"></i>
      Paiement effectué avec succès!
    </div>

    <!-- Formulaire de paiement -->
    <form *ngIf="!paymentSuccess" (ngSubmit)="submitPayment()">
      
      <!-- Sélection du réseau -->
      <div class="mb-4">
        <label class="block text-gray-700 font-semibold mb-2">
          <i class="fa fa-network-wired mr-2"></i>
          Réseau Mobile Money
        </label>
        <div class="flex gap-3">
          <label class="flex items-center cursor-pointer">
            <input 
              type="radio" 
              name="network" 
              value="TMONEY" 
              [(ngModel)]="paymentForm.network"
              class="mr-2">
            <span class="text-sm">T-Money</span>
          </label>
          <label class="flex items-center cursor-pointer">
            <input 
              type="radio" 
              name="network" 
              value="FLOOZ" 
              [(ngModel)]="paymentForm.network"
              class="mr-2">
            <span class="text-sm">Flooz</span>
          </label>
        </div>
      </div>

      <!-- Numéro de téléphone -->
      <div class="mb-4">
        <label class="block text-gray-700 font-semibold mb-2">
          <i class="fa fa-phone mr-2"></i>
          Numéro de téléphone
        </label>
        <input 
          type="tel" 
          [(ngModel)]="paymentForm.phone"
          name="phone"
          placeholder="Ex: 90123456"
          class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
          required>
      </div>

      <!-- Montant -->
      <div class="mb-6">
        <label class="block text-gray-700 font-semibold mb-2">
          <i class="fa fa-money-bill mr-2"></i>
          Montant (FCFA)
        </label>
        <input 
          type="number" 
          [(ngModel)]="paymentForm.amount"
          name="amount"
          placeholder="Ex: 50000"
          class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
          required>
      </div>

      <!-- Boutons d'action -->
      <div class="flex gap-3">
        <button 
          type="button"
          (click)="closePaymentForm()"
          class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded transition duration-200"
          [disabled]="paymentProcessing">
          Annuler
        </button>
        <button 
          type="submit"
          class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded transition duration-200 flex items-center justify-center"
          [disabled]="paymentProcessing">
          <i *ngIf="!paymentProcessing" class="fa fa-check mr-2"></i>
          <i *ngIf="paymentProcessing" class="fa fa-spinner fa-spin mr-2"></i>
          {{ paymentProcessing ? 'Traitement...' : 'Payer' }}
        </button>
      </div>
    </form>

  </div>
</div>
