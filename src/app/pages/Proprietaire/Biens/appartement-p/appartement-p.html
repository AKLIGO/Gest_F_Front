<!-- Page Mes Appartements - Propriétaire -->
<div class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 py-8">
  <div class="container mx-auto px-4">
    
    <!-- Header Section -->
    <div class="text-center mb-12">
      <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full mb-6">
        <i class="fas fa-home text-white text-2xl"></i>
      </div>
      <h1 class="text-4xl font-bold text-gray-900 mb-4">
        Mes <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600">Appartements</span>
      </h1>
      <p class="text-xl text-gray-600 max-w-2xl mx-auto">
        Gérez et suivez vos appartements en location. Visualisez leurs statuts et performances.
      </p>
    </div>

    <!-- Statistiques -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
      <div class="bg-white/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-white/20">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-gray-600">Total</p>
            <p class="text-3xl font-bold text-gray-900">{{ appartements.length }}</p>
          </div>
          <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
            <i class="fas fa-building text-blue-600"></i>
          </div>
        </div>
      </div>
      
      <div class="bg-white/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-white/20">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-gray-600">Disponibles</p>
            <p class="text-3xl font-bold text-green-600">{{ getDisponiblesCount() }}</p>
          </div>
          <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
            <i class="fas fa-check-circle text-green-600"></i>
          </div>
        </div>
      </div>
      
      <div class="bg-white/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-white/20">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-gray-600">Loués</p>
            <p class="text-3xl font-bold text-red-600">{{ getLouesCount() }}</p>
          </div>
          <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center">
            <i class="fas fa-key text-red-600"></i>
          </div>
        </div>
      </div>
      
      <div class="bg-white/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-white/20">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-gray-600">Réservés</p>
            <p class="text-3xl font-bold text-yellow-600">{{ getReservesCount() }}</p>
          </div>
          <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center">
            <i class="fas fa-clock text-yellow-600"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="text-center py-12">
      <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-r from-blue-100 to-purple-100 rounded-full mb-6 animate-pulse">
        <i class="fas fa-spinner fa-spin text-blue-600 text-3xl"></i>
      </div>
      <h3 class="text-xl font-semibold text-gray-900 mb-2">Chargement en cours...</h3>
      <p class="text-gray-600 mb-4">Récupération de vos appartements</p>
      <div class="w-64 bg-gray-200 rounded-full h-2 mx-auto">
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 h-2 rounded-full animate-pulse" style="width: 60%"></div>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="errorMessage && !isLoading" class="text-center py-12">
      <div class="inline-flex items-center justify-center w-16 h-16 bg-red-100 rounded-full mb-4">
        <i class="fas fa-exclamation-triangle text-red-600 text-2xl"></i>
      </div>
      <p class="text-red-600 mb-4">{{ errorMessage }}</p>
      <button (click)="loadAppartementsProprietaire()" 
              class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
        <i class="fas fa-refresh mr-2"></i>Réessayer
      </button>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && !errorMessage && appartements.length === 0" class="text-center py-12">
      <div class="inline-flex items-center justify-center w-16 h-16 bg-gray-100 rounded-full mb-4">
        <i class="fas fa-home text-gray-400 text-2xl"></i>
      </div>
      <h3 class="text-xl font-semibold text-gray-900 mb-2">Aucun appartement trouvé</h3>
      <p class="text-gray-600 mb-6">Vous n'avez pas encore d'appartements enregistrés.</p>
      <button (click)="openAddModal()" class="px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all duration-300 transform hover:scale-105">
        <i class="fas fa-plus mr-2"></i>Ajouter un appartement
      </button>
    </div>

    <!-- Boutons d'action -->
    <div *ngIf="!isLoading && !errorMessage && appartements.length > 0" class="mb-6 flex justify-center space-x-4">
      <button (click)="openAddModal()" class="px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all duration-300 transform hover:scale-105 shadow-lg">
        <i class="fas fa-plus mr-2"></i>Ajouter un appartement
      </button>
      <button (click)="refreshData()" class="px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all duration-300 transform hover:scale-105 shadow-lg">
        <i class="fas fa-sync-alt mr-2"></i>Actualiser
      </button>
    </div>

    <!-- Liste des Appartements -->
    <div *ngIf="!isLoading && !errorMessage && appartements.length > 0" 
         class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
      
      <div *ngFor="let app of appartements" 
           class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 overflow-hidden hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1">
        
        <!-- Header Card -->
        <div class="p-6 border-b border-gray-100">
          <div class="flex items-start justify-between mb-4">
            <div class="flex items-center space-x-3">
              <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-500 rounded-xl flex items-center justify-center">
                <i class="fas fa-home text-white"></i>
              </div>
              <div>
                <h3 class="text-lg font-bold text-gray-900">{{ app.nom }}</h3>
                <p class="text-sm text-gray-600">Appartement #{{ app.numero }}</p>
              </div>
            </div>
            <span class="px-3 py-1 text-xs font-semibold rounded-full"
                  [ngClass]="getStatutClass(app.statut)">
              {{ app.statut }}
            </span>
          </div>
          
          <div class="space-y-2">
            <div class="flex items-center text-sm text-gray-600">
              <i class="fas fa-map-marker-alt mr-2 text-blue-500"></i>
              {{ app.adresse }}
            </div>
            <div class="flex items-center text-sm text-gray-600">
              <i class="fas fa-building mr-2 text-purple-500"></i>
              {{ getImmeubleNom(app) }}
            </div>
          </div>
        </div>

        <!-- Details Card -->
        <div class="p-6">
          <div class="grid grid-cols-2 gap-4 mb-4">
            <div class="text-center p-3 bg-gray-50 rounded-lg">
              <div class="text-2xl font-bold text-gray-900">{{ app.prix | currency:'XOF':'symbol':'1.0-0':'fr' }}</div>
              <div class="text-xs text-gray-600">Prix mensuel</div>
            </div>
            <div class="text-center p-3 bg-gray-50 rounded-lg">
              <div class="text-2xl font-bold text-gray-900">{{ app.superficie }}</div>
              <div class="text-xs text-gray-600">Superficie</div>
            </div>
          </div>
          
          <div class="flex items-center justify-between mb-4">
            <span class="px-3 py-1 text-xs font-semibold rounded-full"
                  [ngClass]="getTypeClass(app.type)">
              {{ app.type }}
            </span>
            <span class="text-sm text-gray-600">
              <i class="fas fa-bed mr-1"></i>{{ app.nbrDePieces }} pièce(s)
            </span>
          </div>
          
          <p class="text-sm text-gray-600 mb-4 line-clamp-2">{{ app.description }}</p>
          
          <!-- Actions -->
          <div class="flex space-x-2">
            <button (click)="openEditModal(app)" class="flex-1 px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors">
              <i class="fas fa-edit mr-2"></i>Modifier
            </button>
            <button (click)="openDetailsModal(app)" class="flex-1 px-4 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-200 transition-colors">
              <i class="fas fa-eye mr-2"></i>Voir détails
            </button>
          </div>
          
          <!-- Bouton Supprimer -->
          <div class="mt-2">
            <button (click)="deleteAppartement(app.id!)" class="w-full px-4 py-2 bg-red-100 text-red-700 text-sm font-medium rounded-lg hover:bg-red-200 transition-colors">
              <i class="fas fa-trash mr-2"></i>Supprimer
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modale pour Ajouter/Modifier/Voir détails -->
  <div *ngIf="showModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
      
      <!-- Header de la modale -->
      <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 rounded-t-2xl">
        <div class="flex items-center justify-between">
          <h3 class="text-xl font-bold">
            <i class="fas fa-home mr-2"></i>
            {{ isEditMode ? 'Modifier l\'appartement' : selectedAppartement ? 'Détails de l\'appartement' : 'Ajouter un appartement' }}
          </h3>
          <button (click)="closeModal()" class="text-white hover:text-gray-200 transition-colors">
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
      </div>

      <!-- Contenu de la modale -->
      <div class="p-6">
        
        <!-- Mode Détails -->
        <div *ngIf="selectedAppartement && !isEditMode" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Nom</label>
                <div class="p-3 bg-gray-50 rounded-lg">{{ selectedAppartement.nom }}</div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Adresse</label>
                <div class="p-3 bg-gray-50 rounded-lg">{{ selectedAppartement.adresse }}</div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Prix mensuel</label>
                <div class="p-3 bg-gray-50 rounded-lg">{{ selectedAppartement.prix | currency:'XOF':'symbol':'1.0-0':'fr' }}</div>
              </div>
            </div>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Numéro</label>
                <div class="p-3 bg-gray-50 rounded-lg">#{{ selectedAppartement.numero }}</div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Superficie</label>
                <div class="p-3 bg-gray-50 rounded-lg">{{ selectedAppartement.superficie }}</div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Localisation</label>
                <div class="p-3 bg-gray-50 rounded-lg">{{ selectedAppartement.localisation}}</div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Nombre de pièces</label>
                <div class="p-3 bg-gray-50 rounded-lg">{{ selectedAppartement.nbrDePieces }}</div>
              </div>
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Type</label>
              <span class="inline-block px-3 py-1 text-xs font-semibold rounded-full"
                    [ngClass]="getTypeClass(selectedAppartement.type)">
                {{ selectedAppartement.type }}
              </span>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Statut</label>
              <span class="inline-block px-3 py-1 text-xs font-semibold rounded-full"
                    [ngClass]="getStatutClass(selectedAppartement.statut)">
                {{ selectedAppartement.statut }}
              </span>
            </div>
          </div>
          
          <div *ngIf="selectedAppartement.description">
            <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
            <div class="p-3 bg-gray-50 rounded-lg">{{ selectedAppartement.description }}</div>
          </div>
        </div>

        <!-- Mode Formulaire (Ajouter/Modifier) -->
        <form *ngIf="!selectedAppartement" [formGroup]="appartementForm" (ngSubmit)="submitForm()" class="space-y-6">
          
          <!-- Nom et Adresse -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">
                <i class="fas fa-home mr-2 text-blue-500"></i>Nom de l'appartement *
              </label>
              <input type="text" formControlName="nom" placeholder="Ex: Appartement A22"
                     class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white">
              <div *ngIf="appartementForm.get('nom')?.invalid && appartementForm.get('nom')?.touched" class="text-red-500 text-sm flex items-center">
                <i class="fas fa-exclamation-circle mr-1"></i>
                Le nom est requis.
              </div>
            </div>
            
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">
                <i class="fas fa-map-marker-alt mr-2 text-blue-500"></i>Adresse *
              </label>
              <input type="text" formControlName="adresse" placeholder="Ex: Avenue de la Paix"
                     class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white">
              <div *ngIf="appartementForm.get('adresse')?.invalid && appartementForm.get('adresse')?.touched" class="text-red-500 text-sm flex items-center">
                <i class="fas fa-exclamation-circle mr-1"></i>
                L'adresse est requise.
              </div>
            </div>

            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">
                <i class="fas fa-map-marker-alt mr-2 text-blue-500"></i>Localisation *
              </label>
              <input type="text" formControlName="localisation" placeholder="inserer le lien google map"
                     class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white">
              <div *ngIf="appartementForm.get('localisation')?.invalid && appartementForm.get('localisation')?.touched" class="text-red-500 text-sm flex items-center">
                <i class="fas fa-exclamation-circle mr-1"></i>
                Localisation est requise.
              </div>
            </div>
          </div>

          <!-- Prix et Superficie -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">
                <i class="fas fa-money-bill-wave mr-2 text-green-500"></i>Prix Journalier (FCFA) *
              </label>
              <input type="number" formControlName="prix" placeholder="Ex: 50000"
                     class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white">
              <div *ngIf="appartementForm.get('prix')?.invalid && appartementForm.get('prix')?.touched" class="text-red-500 text-sm flex items-center">
                <i class="fas fa-exclamation-circle mr-1"></i>
                Le prix est requis et doit être supérieur à 0.
              </div>
            </div>
            
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">
                <i class="fas fa-expand-arrows-alt mr-2 text-purple-500"></i>Superficie *
              </label>
              <input type="text" formControlName="superficie" placeholder="Ex: 50m²"
                     class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white">
              <div *ngIf="appartementForm.get('superficie')?.invalid && appartementForm.get('superficie')?.touched" class="text-red-500 text-sm flex items-center">
                <i class="fas fa-exclamation-circle mr-1"></i>
                La superficie est requise.
              </div>
            </div>
          </div>

          <!-- Numéro et Nombre de pièces -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">
                <i class="fas fa-hashtag mr-2 text-blue-500"></i>Numéro d'appartement *
              </label>
              <input type="number" formControlName="numero" placeholder="Ex: 101"
                     class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white">
              <div *ngIf="appartementForm.get('numero')?.invalid && appartementForm.get('numero')?.touched" class="text-red-500 text-sm flex items-center">
                <i class="fas fa-exclamation-circle mr-1"></i>
                Le numéro est requis.
              </div>
            </div>
            
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">
                <i class="fas fa-bed mr-2 text-indigo-500"></i>Nombre de pièces *
              </label>
              <input type="number" formControlName="nbrDePieces" placeholder="Ex: 3"
                     class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white">
              <div *ngIf="appartementForm.get('nbrDePieces')?.invalid && appartementForm.get('nbrDePieces')?.touched" class="text-red-500 text-sm flex items-center">
                <i class="fas fa-exclamation-circle mr-1"></i>
                Le nombre de pièces est requis.
              </div>
            </div>
          </div>

          <!-- Type et Statut -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">
                <i class="fas fa-tags mr-2 text-purple-500"></i>Type d'appartement *
              </label>
              <select formControlName="type" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white">
                <option value="">Sélectionner un type</option>
                <option *ngFor="let type of typeOptions" [value]="type">{{ type }}</option>
              </select>
              <div *ngIf="appartementForm.get('type')?.invalid && appartementForm.get('type')?.touched" class="text-red-500 text-sm flex items-center">
                <i class="fas fa-exclamation-circle mr-1"></i>
                Le type est requis.
              </div>
            </div>
            
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">
                <i class="fas fa-info-circle mr-2 text-green-500"></i>Statut *
              </label>
              <select formControlName="statut" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white">
                <option value="">Sélectionner un statut</option>
                <option *ngFor="let statut of statutOptions" [value]="statut">{{ statut }}</option>
              </select>
              <div *ngIf="appartementForm.get('statut')?.invalid && appartementForm.get('statut')?.touched" class="text-red-500 text-sm flex items-center">
                <i class="fas fa-exclamation-circle mr-1"></i>
                Le statut est requis.
              </div>
            </div>
          </div>

          <!-- Immeuble et Description -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">
                <i class="fas fa-building mr-2 text-gray-500"></i>Immeuble *
              </label>
              <select formControlName="immeubleId" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white">
                <option value="">Sélectionner un immeuble</option>
                <option *ngFor="let immeuble of immeubles" [value]="immeuble.id">{{ immeuble.nom }}</option>
              </select>
              <div *ngIf="appartementForm.get('immeubleId')?.invalid && appartementForm.get('immeubleId')?.touched" class="text-red-500 text-sm flex items-center">
                <i class="fas fa-exclamation-circle mr-1"></i>
                L'immeuble est requis.
              </div>
            </div>
            
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">
                <i class="fas fa-align-left mr-2 text-gray-500"></i>Description
              </label>
              <textarea formControlName="description" placeholder="Description de l'appartement..."
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white resize-none" rows="3"></textarea>
            </div>
          </div>

          <!-- Boutons d'action -->
          <div class="flex justify-end space-x-4 pt-6 border-t border-gray-200">
            <button type="button" (click)="closeModal()" 
                    class="px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-xl hover:bg-gray-50 transition-colors">
              <i class="fas fa-times mr-2"></i>Annuler
            </button>
            <button type="submit" [disabled]="appartementForm.invalid"
                    class="px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-medium rounded-xl hover:from-blue-700 hover:to-purple-700 transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
              <i class="fas fa-save mr-2"></i>
              {{ isEditMode ? 'Mettre à jour' : 'Ajouter l\'appartement' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
